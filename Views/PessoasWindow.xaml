<Window x:Class="WpfApp.Views.PessoasWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
        Title="Cadastro de Pessoas" Height="620" Width="960"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <!-- Borda vermelha + tooltip quando houver erro de validação -->
        <Style x:Key="ValidationTextBoxStyle" TargetType="TextBox">
            <Setter Property="Margin" Value="2"/>
            <Setter Property="ToolTip" Value="{Binding (Validation.Errors)[0].ErrorContent, 
                                                      RelativeSource={RelativeSource Self}}"/>
            <Style.Triggers>
                <Trigger Property="Validation.HasError" Value="True">
                    <Setter Property="BorderBrush" Value="Red"/>
                    <Setter Property="BorderThickness" Value="1.5"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ValidationMaskedStyle" TargetType="{x:Type xctk:MaskedTextBox}">
            <Setter Property="Margin" Value="2"/>
            <Setter Property="ToolTip" Value="{Binding (Validation.Errors)[0].ErrorContent, 
                                                      RelativeSource={RelativeSource Self}}"/>
            <Style.Triggers>
                <Trigger Property="Validation.HasError" Value="True">
                    <Setter Property="BorderBrush" Value="Red"/>
                    <Setter Property="BorderThickness" Value="1.5"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- (1) FILTROS -->
        <GroupBox Header="Filtros" Padding="8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="260"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="160"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Label Content="Nome:" VerticalAlignment="Center"/>
                <TextBox Grid.Column="1" MaxLength="255"
                         Text="{Binding FiltroNome, UpdateSourceTrigger=PropertyChanged}"
                         ToolTip="Digite parte do nome para filtrar"/>

                <Label Grid.Column="3" Content="CPF:" VerticalAlignment="Center"/>

                <!-- Máscara de CPF: use pontos e traço -->
                <xctk:MaskedTextBox Grid.Column="4"
                                    Mask="000,000,000-00"
                                    Text="{Binding FiltroCpf, UpdateSourceTrigger=PropertyChanged}"
                                    ToolTip="Digite o CPF para filtrar"/>

                <Button Grid.Column="6" Command="{Binding FiltrarCmd}">
                    <StackPanel Orientation="Horizontal">
                        <Image Source="/Resources/filter.png" Width="16" Height="16" Margin="0,0,6,0"/>
                        <TextBlock Text="Filtrar"/>
                    </StackPanel>
                </Button>
            </Grid>
        </GroupBox>

        <!-- (2) LISTA (GRID)  -->
        <GroupBox Grid.Row="1" Header="Lista de Pessoas" Padding="8" Margin="0,8,0,8">
            <DataGrid ItemsSource="{Binding PessoasCollection}"
                      SelectedItem="{Binding PessoaSelecionada, Mode=TwoWay}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      SelectionMode="Single"
                      SelectionUnit="FullRow">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Id" Binding="{Binding Id}" Width="60" IsReadOnly="True"/>
                    <DataGridTextColumn Header="Nome" Binding="{Binding Nome}" Width="*"/>
                    <DataGridTextColumn Header="CPF"  Binding="{Binding CPF}"  Width="150"/>
                    <DataGridTextColumn Header="Endereço" Binding="{Binding Endereco}" Width="*"/>
                </DataGrid.Columns>
            </DataGrid>
        </GroupBox>

        <!-- (3) DETALHES + AÇÕES -->
        <GroupBox Grid.Row="2" Header="Detalhes da Pessoa Selecionada / Novo Cadastro" Padding="8">
            <Grid>
                <Grid.RowDefinitions>                    
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <Grid Grid.Row="0" Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="260"/>
                        <ColumnDefinition Width="24"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="160"/>
                        <ColumnDefinition Width="24"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="340"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="Nome:" VerticalAlignment="Center" Margin="2"/>
                    <TextBox Grid.Column="1"
                             Style="{StaticResource ValidationTextBoxStyle}"
                             Text="{Binding PessoaEdicao.Nome, 
                                            UpdateSourceTrigger=PropertyChanged, 
                                            ValidatesOnDataErrors=True}"
                             ToolTip="Nome completo"
                             MaxLength="255"
                             IsEnabled="{Binding IsCamposHabilitados}"/>

                    <TextBlock Grid.Column="3" Text="CPF:" VerticalAlignment="Center" Margin="2"/>

                    <xctk:MaskedTextBox Grid.Column="4"
                                        Style="{StaticResource ValidationMaskedStyle}"
                                        Mask="000,000,000-00"
                                        Text="{Binding PessoaEdicao.CPF, 
                                                       UpdateSourceTrigger=PropertyChanged, 
                                                       ValidatesOnDataErrors=True}"
                                        ToolTip="CPF no formato 000.000.000-00"
                                        IsEnabled="{Binding IsCamposHabilitados}" Margin="2,2,31,2"/>

                    <TextBlock Grid.Column="5" Text="Endereço:" VerticalAlignment="Center" Margin="0,0,28,0" Grid.ColumnSpan="2"/>
                    <TextBox Grid.Column="5"
                             Style="{StaticResource ValidationTextBoxStyle}"
                             Text="{Binding PessoaEdicao.Endereco, 
                                            UpdateSourceTrigger=PropertyChanged, 
                                            ValidatesOnDataErrors=True}"
                             ToolTip="Endereço (opcional)"
                             MaxLength="255"
                             IsEnabled="{Binding IsCamposHabilitados}" Grid.ColumnSpan="3" Margin="57,3,40,1"/>
                </Grid>
                
                <WrapPanel Grid.Row="1" ItemHeight="32" ItemWidth="140" Margin="0,0,0,4">                    
                    <Button Command="{Binding IncluirCmd}" Margin="0,0,8,8">
                        <StackPanel Orientation="Horizontal">
                            <Image Source="/Resources/insert.png" Width="16" Height="16" Margin="0,0,6,0"/>
                            <TextBlock Text="Novo"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Command="{Binding SalvarCmd}" 
                            IsEnabled="{Binding IsCamposHabilitados}"
                            Margin="0,0,8,8">
                        <StackPanel Orientation="Horizontal">
                            <Image Source="/Resources/save.png" Width="16" Height="16" Margin="0,0,6,0"/>
                            <TextBlock Text="Salvar"/>
                        </StackPanel>
                    </Button>
                   
                    <Button Command="{Binding CancelarCmd}" 
                            IsEnabled="{Binding IsCamposHabilitados}"
                            Margin="0,0,8,8">
                        <StackPanel Orientation="Horizontal">
                            <Image Source="/Resources/cancel.png" Width="16" Height="16" Margin="0,0,6,0"/>
                            <TextBlock Text="Cancelar"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Command="{Binding ExcluirCmd}" IsEnabled="{Binding IsCamposHabilitados}" Margin="0,0,8,8">
                        <StackPanel Orientation="Horizontal">
                            <Image Source="/Resources/garbage.png" Width="16" Height="16" Margin="0,0,6,0"/>
                            <TextBlock Text="Excluir"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Command="{Binding IncluirPedidoCmd}" IsEnabled="{Binding IsCamposHabilitados}" Margin="0,0,8,8">                        
                        <StackPanel Orientation="Horizontal">
                            <Image Source="/Resources/insert-order.png" Width="16" Height="16" Margin="0,0,6,0"/>
                            <TextBlock Text="Incluir Pedido"/>
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding ConsultaPedidosCmd}" IsEnabled="{Binding IsCamposHabilitados}" Margin="0,0,8,8">
                        <StackPanel Orientation="Horizontal">
                            <Image Source="/Resources/find.png" Width="16" Height="16" Margin="0,0,6,0"/>
                            <TextBlock Text="Ver Pedidos"/>
                        </StackPanel>
                    </Button>
                </WrapPanel>
            </Grid>
        </GroupBox>
    </Grid>
</Window>
