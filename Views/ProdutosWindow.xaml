<Window x:Class="WpfApp.Views.ProdutosWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
        Title="Cadastro de Produtos" Height="620" Width="960"
        WindowStartupLocation="CenterScreen">

    <Grid Margin="8">
        <Grid.RowDefinitions>
            <!-- 1) Filtros -->
            <RowDefinition Height="Auto"/>
            <!-- 2) Lista -->
            <RowDefinition Height="*"/>
            <!-- 3) Detalhes + Ações -->
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- (1) FILTROS -->
        <GroupBox Header="Filtros" Padding="8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="260"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="180"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="100"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="100"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Label Content="Nome:" VerticalAlignment="Center"/>
                <TextBox MaxLength="255"
                         Text="{Binding FiltroNome, UpdateSourceTrigger=PropertyChanged}"
                         ToolTip="Digite parte do nome para filtrar" Grid.ColumnSpan="5" Margin="45,0,133,0"/>

                <Label Grid.Column="4" Content="Código:" VerticalAlignment="Center" Margin="52,0,77,0"/>
                <TextBox Grid.Column="4" MaxLength="50"
                         Text="{Binding FiltroCodigo, UpdateSourceTrigger=PropertyChanged}"
                         ToolTip="Digite parte do código para filtrar" Margin="108,0,0,0"/>

                <Label Grid.Column="6" Content="Valor mín.:" VerticalAlignment="Center"/>
                <xctk:DecimalUpDown Grid.Column="7"
                                    Value="{Binding FiltroMin, UpdateSourceTrigger=PropertyChanged}"
                                    FormatString="F2" Minimum="0" Margin="0,0,92,0"/>

                <Label Grid.Column="7" Content="Valor máx.:" VerticalAlignment="Center" Grid.ColumnSpan="2" Margin="80,0,20,0"/>
                <xctk:DecimalUpDown Grid.Column="7"
                                    Value="{Binding FiltroMax, UpdateSourceTrigger=PropertyChanged}"
                                    FormatString="F2" Minimum="0" Grid.ColumnSpan="3" Margin="148,0,117,0"/>

                <Button Grid.Column="9" Command="{Binding FiltrarCmd}" Margin="60,0,42,0" Grid.ColumnSpan="3">
                    <StackPanel Orientation="Horizontal">
                        <Image Source="/Resources/filter.png" Width="16" Height="16" Margin="0,0,6,0"/>
                        <TextBlock Text="Filtrar"/>
                    </StackPanel>
                </Button>
            </Grid>
        </GroupBox>

        <!-- (2) LISTA -->
        <GroupBox Grid.Row="1" Header="Lista de Produtos" Padding="8" Margin="0,8,0,8">
            <DataGrid ItemsSource="{Binding ProdutosCollection}"
                      SelectedItem="{Binding ProdutoSelecionado}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      CanUserAddRows="False"
                      SelectionMode="Single">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Id" Binding="{Binding Id}" IsReadOnly="True" Width="60"/>
                    <DataGridTextColumn Header="Nome" Binding="{Binding Nome}" Width="*"/>
                    <DataGridTextColumn Header="Código" Binding="{Binding Codigo}" Width="150"/>
                    <DataGridTextColumn Header="Valor" Binding="{Binding Valor, StringFormat=\{0:C2\},ConverterCulture='pt-BR'}" Width="120"/>
                </DataGrid.Columns>
            </DataGrid>
        </GroupBox>

        <!-- (3) DETALHES + AÇÕES -->
        <GroupBox Grid.Row="2" Header="Detalhes do Produto Selecionado / Novo Cadastro" Padding="8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <!-- formulário -->
                    <RowDefinition Height="Auto"/>
                    <!-- botões -->
                </Grid.RowDefinitions>

                <!-- Formulário -->
                <Grid Grid.Row="0" Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="300"/>
                        <ColumnDefinition Width="24"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="200"/>
                        <ColumnDefinition Width="24"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="140"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="Nome:" VerticalAlignment="Center" Margin="2"/>
                    <TextBox Grid.Column="1" Margin="2" MaxLength="255"
                             Text="{Binding ProdutoEdicao.Nome, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"
                             ToolTip="Nome do produto" IsEnabled="{Binding IsCamposHabilitados}"/>

                    <TextBlock Grid.Column="3" Text="Código:" VerticalAlignment="Center" Margin="2"/>
                    <TextBox Grid.Column="4" Margin="2" MaxLength="50"
                             Text="{Binding ProdutoEdicao.Codigo, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"
                             ToolTip="Código do produto" IsEnabled="{Binding IsCamposHabilitados}"/>

                    <TextBlock Grid.Column="6" Text="Valor:" VerticalAlignment="Center" Margin="2"/>
                    <xctk:DecimalUpDown Grid.Column="7" Margin="2"
                                        Value="{Binding ProdutoEdicao.Valor, UpdateSourceTrigger=PropertyChanged}"
                                        FormatString="F2" Minimum="0"
                                        IsEnabled="{Binding IsCamposHabilitados}"/>
                </Grid>

                <!-- Botões -->
                <WrapPanel Grid.Row="1" ItemHeight="32" ItemWidth="140" Margin="0,0,0,4">
                    <Button Command="{Binding IncluirCmd}" Margin="0,0,8,0">
                        <StackPanel Orientation="Horizontal">
                            <Image Source="/Resources/insert.png" Width="16" Height="16" Margin="0,0,6,0"/>
                            <TextBlock Text="Novo"/>
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding SalvarCmd}" Margin="0,0,8,0" IsEnabled="{Binding IsCamposHabilitados}">
                        <StackPanel Orientation="Horizontal">
                            <Image Source="/Resources/save.png" Width="16" Height="16" Margin="0,0,6,0"/>
                            <TextBlock Text="Salvar"/>
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding CancelarCmd}" Margin="0,0,8,0" IsEnabled="{Binding IsCamposHabilitados}">
                        <StackPanel Orientation="Horizontal">
                            <Image Source="/Resources/cancel.png" Width="16" Height="16" Margin="0,0,6,0"/>
                            <TextBlock Text="Cancelar"/>
                        </StackPanel>
                    </Button>

                    <!-- Deixe o CanExecute do comando controlar o IsEnabled -->
                    <Button Command="{Binding ExcluirCmd}" Margin="0,0,8,0">
                        <StackPanel Orientation="Horizontal">
                            <Image Source="/Resources/garbage.png" Width="16" Height="16" Margin="0,0,6,0"/>
                            <TextBlock Text="Excluir"/>
                        </StackPanel>
                    </Button>
                </WrapPanel>
            </Grid>
        </GroupBox>
    </Grid>
</Window>
